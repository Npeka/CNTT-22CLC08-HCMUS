--ghi chú 1 dòng
/*ghi chú n dòng*/
--CHUYỂN CSDL ĐANG DÙNG THÀNH CSDL KHÁC QLDOIBONG => ĐỂ XÓA
USE master
GO
--kiểm tra csdl muốn tạo đã tồn tại chưa?
IF DB_ID('QLDOIBONG') IS NOT NULL --CSDL QLDOIBONG ĐÃ TỒN TẠI
	--XÓA CSDL QLDOIBONG
	DROP DATABASE QLDOIBONG
--LỆNH GO ĐỂ KHỐI LỆNH Ở TRÊN KẾT THÚC MỚI ĐI TIẾP
GO
--TẠO CSDL QLDOIBONG
CREATE DATABASE QLDOIBONG
GO
--LỆNH USE ĐỂ SỬ DỤNG CSDL QLDOIBONG ĐỂ TẠO BẢNG
USE QLDOIBONG
GO
--TẠO TẤT CẢ CÁC BẢNG + PK TRONG CSDL
CREATE TABLE DOI
(
	--KHAI BÁO THUỘC TÍNH
	IDDOI INT,
	TENDOI NVARCHAR(50),
	DOITRUONG INT,
	SOLUONG INT

	--KHAI BÁO KHÓA CHÍNH
	CONSTRAINT PK_DOI --LỆNH ĐẶT TÊN CHO KHÓA CHÍNH
	PRIMARY KEY(IDDOI) --LỆNH TẠO KHÓA CHÍNH
)
CREATE TABLE BOTRI
(
	IDDOI INT,
	IDTHANHVIEN INT,
	DIACHI NVARCHAR(100),
	NHIEMVU NVARCHAR(100),
	QUANLI INT

	--KHAI BÁO KHÓA CHÍNH
	CONSTRAINT PK_BOTRI
	PRIMARY KEY(IDDOI,IDTHANHVIEN)
)
CREATE TABLE THANHVIEN
(
	IDTHANHVIEN INT,
	HOTEN NVARCHAR(50),
	DIACHI NVARCHAR(50),
	SOCMND CHAR(9),
	NGAYSINH DATE

	CONSTRAINT PK_THANHVIEN
	PRIMARY KEY(IDTHANHVIEN)
)
--TẠO KHÓA NGOẠI & DÂY LIÊN KẾT
ALTER TABLE BOTRI
ADD
	CONSTRAINT FK_BOTRI_DOI --ĐẶT TÊN
	FOREIGN KEY(IDDOI) --KHAI BÁO KHÓA NGOẠI
	REFERENCES DOI, --TẠO DÂY LIÊN KẾT
	
	CONSTRAINT FK_BOTRI_THANHVIEN_TV
	FOREIGN KEY(IDTHANHVIEN)
	REFERENCES THANHVIEN,
	
	CONSTRAINT FK_BOTRI_THANHVIEN_QL
	FOREIGN KEY(QUANLI)
	REFERENCES THANHVIEN
--NHẬP LIỆU VÀO BẢNG
INSERT DOI(IDDOI,TENDOI)
VALUES(2,N'ĐỘI TÂN PHÚ'),
	  (7,N'ĐỘI BÌNH PHÚ')
--KIỂM TRA LẠI DỮ LIỆU BẢNG ĐÃ CÓ CHƯA
SELECT * --LẤY TOÀN BỘ THUỘC TÍNH
FROM DOI --TỪ BẢNG DOI

SET DATEFORMAT DMY --LỆNH ĐỂ ĐỔI ĐỊNH DẠNG NHẬP NGÀY
GO
INSERT THANHVIEN(IDTHANHVIEN,HOTEN,SOCMND,DIACHI,NGAYSINH)
VALUES(1,N'Nguyễn Quan Tùng', '240674018', N'TPHCM', '30/1/2000'),
	  (2, N'Lưu Phi Nam', '240674027', N'Quảng Nam', '12/3/2001'),
	  (3, N'Lê Quang Bảo', '240674063', N'Quảng Ngãi', '14/5/1999'),
	  (4, N'Hà Ngọc Thúy', '240674504', N'TPHCM','26/7/1998'),
	  (5, N'Trương Thị Minh', '240674405', N'Hà Nội' ,Null),
	  (6, N'Ngô Thị Thủy', '240674306', null, '18/9/2000')
SELECT * 
FROM THANHVIEN
--CẬP NHẬT LẠI DỮ LIỆU ĐỂ TRỐNG
UPDATE DOI
SET DOITRUONG = 1, SOLUONG = 11 --GIÁ TRỊ MỚI
WHERE IDDOI = 2 --ĐIỀU KIỆN TÌM DÒNG CẦN CẬP NHẬT

UPDATE DOI
SET DOITRUONG = 5
WHERE IDDOI = 7

SELECT * FROM DOI