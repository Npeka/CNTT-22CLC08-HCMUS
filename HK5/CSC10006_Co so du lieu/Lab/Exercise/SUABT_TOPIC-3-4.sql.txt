--nhắc lại cấu trúc câu truy vấn đầy đủ
-- 5 SELECT
--1 FROM 
--2 WHERE
--3 GROUP BY
--4 HAVING --ĐIỀU KIỆN LỌC TRÊN NHÓM
--ORDER BY --SẮP XẾP THỨ TỰ HIỂN THỊ CỦA DỮ LIỆU
--SẮP TĂNG ASC, DESC
USE QLDETAI
GO
SELECT * FROM THAMGIADT
--TOPIC 3
-- Q11:TÌM HỌ TÊN CỦA TỪNG GV VÀ NGƯỜI PHỤ TRÁCH CHUYÊN MÔN TRỰC TIẾP
SELECT GV.HOTEN TENGV, QL.HOTEN TENQL
FROM GIAOVIEN GV LEFT JOIN GIAOVIEN QL ON GV.GVQLCM = QL.MAGV
--Q18 CHO BIẾT HOTEN GV CÙNG BỘ MÔN VỚI TRẦN TRÀ HƯƠNG
SELECT GV.HOTEN
FROM GIAOVIEN GV  JOIN GIAOVIEN TTH ON TTH.HOTEN = N'TRẦN TRÀ HƯƠNG' AND 
TTH.MABM = GV.MABM
WHERE GV.HOTEN <> N'TRẦN TRÀ HƯƠNG'
--Q9 CHO BIẾT GIÁO VIÊN THUỘC VI SINH THAM GIA ĐỀ TÀI 006
SELECT GV.*
FROM GIAOVIEN GV JOIN BOMON BM ON BM.MABM = GV.MABM
JOIN THAMGIADT TG ON TG.MAGV = GV.MAGV
WHERE BM.TENBM = 'VI SINH'
AND TG.MADT = '006'
--Q22 CHO BIẾT MÃ SỐ TRƯỞNG KHOA CÓ CHỦ NHIỆM ĐỀ TÀI
SELECT DISTINCT GV.MAGV
FROM GIAOVIEN GV JOIN DETAI DT ON GV.MAGV = DT.GVCNDT
JOIN KHOA K ON K.TRUONGKHOA = GV.MAGV
--Q23 CHO BIẾT MÃ SỐ GV THUỘC BỘ MÔN 'HTTT' HOẶC THAM GIA ĐỀ TÀI '001'
SELECT GV.MAGV
FROM GIAOVIEN GV, THAMGIADT TG 
WHERE GV.MABM = 'HTTT' OR (TG.MAGV = GV.MAGV AND TG.MADT = '001')
--TOPC 4:
--Q27:CHO BIẾT SỐ LƯỢNG GV VÀ TỔNG LƯƠNG
SELECT COUNT(MAGV) SLGV, SUM(LUONG) TONGLUON
FROM GIAOVIEN
--28:SO LUONJG GV VÀ LUONG TRUNG BÌNH CỦA TỪNG BM
SELECT COUNT(MAGV) SLGV, AVG(LUONG) LUONGTB
FROM GIAOVIEN GV
GROUP BY GV.MABM
--29 CHO BIẾT TÊN CHỦ ĐỀ VÀ SỐ LƯỢNG ĐỀ TÀI THUỘC CHỦ ĐỀ
SELECT CD.TENCD, COUNT(DT.MADT) SODT
FROM CHUDE CD JOIN DETAI DT ON DT.MACD = CD.MACD
GROUP BY CD.MACD, CD.TENCD
--30 TÊN GV VÀ SỐ LƯỢNG ĐỀ TÀI GV THAM GIA
SELECT GV.HOTEN, COUNT(DISTINCT TG.MADT) SOLUONGDT
FROM GIAOVIEN GV JOIN THAMGIADT TG ON TG.MAGV = GV.MAGV
GROUP BY GV.MAGV, GV.HOTEN
SELECT * FROM DETAI
--31 TÊN GV VÀ SỐ LƯỢNG ĐÈ TÀI CHỦ NHIỆM
SELECT GV.HOTEN, COUNT(MADT) SODT
FROM GIAOVIEN GV JOIN DETAI DT ON DT.GVCNDT = GV.MAGV
GROUP BY GV.MAGV, GV.HOTEN
--32
SELECT GV.HOTEN, COUNT(NT.TEN) SODT
FROM GIAOVIEN GV JOIN NGUOITHAN NT ON NT.MAGV = GV.MAGV
GROUP BY GV.MAGV, GV.HOTEN
--33 cho biết giáo viên tham gia trên 3 đề tài 
SELECT GV.*, COUNT(DISTINCT MADT) SLDT
FROM GIAOVIEN GV JOIN THAMGIADT TG ON TG.MAGV = GV.MAGV
GROUP BY GV.MAGV,GV.DIACHI,GV.GVQLCM,GV.HOTEN,GV.LUONG,GV.MABM,
GV.NGSINH,GV.PHAI
HAVING COUNT(DISTINCT MADT) > 3
--34 CHO BIẾT SỐ LƯỢNG GIÁO VIÊN THAM GIA ĐỀ TÀI ỨNG DỤNG HÓA HỌC XANH
SELECT COUNT(DISTINCT TG.MAGV)
FROM THAMGIADT TG JOIN DETAI DT ON DT.MADT = TG.MADT
WHERE DT.TENDT = N'ỨNG DỤNG HÓA HỌC XANH'
